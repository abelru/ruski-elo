<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fisher Ruski Tracker</title>
     <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>


    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: #00ff00;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 2px solid #00ff00;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            color: #00ff00;
            margin-bottom: 10px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .card {
            background: #111;
            border: 1px solid #00ff00;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .card h2 {
            color: #00ff00;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #00ff00;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            background: #222;
            border: 1px solid #00ff00;
            border-radius: 5px;
            color: #00ff00;
            font-size: 14px;
        }

        .btn {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }

        .btn:hover {
            background: #00cc00;
        }

        .teams-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .team {
            background: #0a0a0a;
            border: 1px solid #00ff00;
            padding: 15px;
            border-radius: 8px;
        }

        .team h3 {
            color: #00ff00;
            text-align: center;
            margin-bottom: 15px;
        }

        .player-stats {
            background: #0a0a0a;
            border: 1px solid #00ff00;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .player-stats h4 {
            color: #00ff00;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2rem;
        }

        .stats-grid-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-box {
            background: #0a0a0a;
            border: 1px solid #00ff00;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #00ff00;
            display: block;
        }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #00ff00;
        }

        .table th {
            background: #0a0a0a;
            color: #00ff00;
            font-weight: bold;
        }

        .table tr:hover td {
            background: #0a0a0a;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #111;
            border-top: 2px solid #00ff00;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 100;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #888;
            background: none;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .nav-btn.active,
        .nav-btn:hover {
            color: #00ff00;
            background: #222;
        }

        .nav-icon {
            font-size: 1.2rem;
            margin-bottom: 2px;
        }

        @media (max-width: 768px) {
            .teams-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid-form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="font-size: 4rem; margin-bottom: 10px;">üç∫</div>
            <h1>Fisher Ruski Tracker</h1>
            <p style="color: #888;">Please Use Fisher Names</p>
        </div>

        <div id="home" class="page active">
            <div class="card">
                <h2>Welcome to Fisher Ruski</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <span class="stat-number" id="total-players">0</span>
                        <div class="stat-label">Players</div>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number" id="total-games">0</span>
                        <div class="stat-label">Games Played</div>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number" id="highest-elo">0</span>
                        <div class="stat-label">Highest ELO</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                    <h2>Highlights</h2>
                    <div style="display:flex;gap:10px;">
                        <button class="btn" onclick="setPeriod('week')" id="btn-week" style="padding:8px 15px;">Week</button>
                        <button class="btn" onclick="setPeriod('month')" id="btn-month" style="padding:8px 15px;background:#666;">Month</button>
                        <button class="btn" onclick="setPeriod('year')" id="btn-year" style="padding:8px 15px;background:#666;">Year</button>
                        <button class="btn" onclick="setPeriod('alltime')" id="btn-alltime" style="padding:8px 15px;background:#666;">All Time</button>
                    </div>
                </div>
                <div class="stats-grid" style="grid-template-columns:repeat(auto-fit,minmax(250px,1fr));">
                    <div class="stat-box" style="background:#002a00;border:2px solid #00ff00;">
                        <div style="font-size:2rem;margin-bottom:10px;">üåü</div>
                        <div class="stat-label" style="margin-bottom:10px;">TOP PLAYER</div>
                        <span class="stat-number" style="font-size:1.5rem;" id="top-player">No data</span>
                        <div style="color:#888;font-size:0.85rem;margin-top:5px;" id="top-player-stat">-</div>
                    </div>
                    <div class="stat-box" style="background:#2a0000;border:2px solid #ff0000;">
                        <div style="font-size:2rem;margin-bottom:10px;">üí©</div>
                        <div class="stat-label" style="margin-bottom:10px;">WORST PLAYER</div>
                        <span class="stat-number" style="font-size:1.5rem;color:#ff6666;" id="worst-player">No data</span>
                        <div style="color:#888;font-size:0.85rem;margin-top:5px;" id="worst-player-stat">-</div>
                    </div>
                    <div class="stat-box" style="background:#1a1a00;border:2px solid #ffff00;">
                        <div style="font-size:2rem;margin-bottom:10px;">üî•</div>
                        <div class="stat-label" style="margin-bottom:10px;">GAME OF PERIOD</div>
                        <span class="stat-number" style="font-size:1.2rem;color:#ffff00;" id="best-game">No data</span>
                        <div style="color:#888;font-size:0.85rem;margin-top:5px;" id="best-game-stat">-</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Recent Games</h2>
                <div id="all-games-list"></div>
                <div id="no-games-yet" style="text-align: center; color: #888; padding: 40px;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">üéÆ</div>
                    <p>No games played yet. Submit your first game!</p>
                </div>
            </div>
        </div>

        <div id="submit" class="page">
            <div class="card">
                <h2>Submit New Game</h2>
                <div id="step1">
                    <div class="form-group">
                        <label>Team Size</label>
                        <select id="team-size">
                            <option value="">Select</option>
                            <option value="1">1v1</option>
                            <option value="2">2v2</option>
                            <option value="3">3v3</option>
                            <option value="4">4v4</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Winner</label>
                        <select id="winning-team">
                            <option value="">Select</option>
                            <option value="1">Team 1</option>
                            <option value="2">Team 2</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Did game go to Overtime?</label>
                        <select id="had-overtime">
                            <option value="no">No</option>
                            <option value="yes">Yes</option>
                        </select>
                    </div>
                    <div id="teams-container"></div>
                    <button class="btn" onclick="goToStep2()" id="next-btn" style="display:none;">Next</button>
                </div>
                <div id="step2" style="display:none;">
                    <div id="individual-stats"></div>
                    <button class="btn" onclick="goToStep1()" style="background:#666;">Back</button>
                    <button class="btn" onclick="submitGame()">Submit</button>
                </div>
            </div>
        </div>

        <div id="rankings" class="page">
            <div class="card">
                <h2>ELO Rankings</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>ELO</th>
                            <th>Games</th>
                            <th>Win %</th>
                        </tr>
                    </thead>
                    <tbody id="rankings-tbody">
                        <tr>
                            <td colspan="5" style="text-align:center;color:#888;padding:40px;">No games yet</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="players" class="page">
            <div class="card">
                <h2>All Players</h2>
                <div id="players-list"></div>
                <div id="no-players" style="text-align:center;color:#888;padding:40px;">No players yet</div>
            </div>
            <div id="player-profile-card" class="card" style="display:none;">
                <button class="btn" onclick="closePlayerProfile()" style="background:#666;float:right;padding:8px 15px;">Back</button>
                <div id="player-profile-content"></div>
            </div>
        </div>

        <div id="rules" class="page">
            <div class="card">
                <h2>Official Fisher Ruski Rules</h2>
                
                <h3 style="color:#00ff00;margin-top:20px;">Overview</h3>
                <p style="color:#ccc;line-height:1.8;">Ruski is a fast-paced, strategic, drinking pong game. Teams of any even number of players compete to hit cups and manage turns, drinking, and formations.</p>
                <ul style="color:#ccc;padding-left:20px;line-height:1.8;margin-top:10px;">
                    <li><strong>Standard 2v2 game:</strong> 10 cups per side, each 16 oz, filled with 1.5 12-oz beers.</li>
                    <li><strong>Scaling:</strong> For larger games, cup/beer counts scale linearly:
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>3v3 ‚Üí 45 beers</li>
                            <li>4v4 ‚Üí 60 beers</li>
                            <li>8v8 ‚Üí 120 beers, etc.</li>
                        </ul>
                    </li>
                </ul>

                <h3 style="color:#00ff00;margin-top:20px;">Starting the Game</h3>
                <ul style="color:#ccc;padding-left:20px;line-height:1.8;">
                    <li><strong>First Shot ‚Äì Eye-to-Eye:</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>Opposing players make eye contact and count to 3.</li>
                            <li>Shoot while maintaining eye contact.</li>
                            <li>Repeat until one player hits a cup and the other team misses.</li>
                        </ul>
                    </li>
                </ul>

                <h3 style="color:#00ff00;margin-top:20px;">Turns & Shooting</h3>
                <ul style="color:#ccc;padding-left:20px;line-height:1.8;">
                    <li><strong>Cup Hit & Sequence:</strong> When a cup is hit, it is removed. The other teammate shoots next.</li>
                    <li><strong>Drinking Times:</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>First cup hit by a team: 1 minute to drink.</li>
                            <li>Subsequent cups: 3 minutes each.</li>
                            <li>If a player drinks multiple cups in a turn, each cup gets its individual time plus a 1-minute pause between cups.</li>
                        </ul>
                    </li>
                    <li><strong>Balls Back:</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>Defense allowed: you can catch or swat a bouncing ball.</li>
                            <li>Bounce shots (off table/floor) are dead.</li>
                            <li>Accidental wall bounces are allowed.</li>
                        </ul>
                    </li>
                    <li><strong>Tri/Quad:</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>If a ball balances between 2 or more cups, all cups it touches are removed and drank.</li>
                            <li>Called a Tri (3 cups) or Quad (4 cups).</li>
                            <li>Tri/Quad does NOT count as hitting a cup for "naked mile" purposes.</li>
                        </ul>
                    </li>
                </ul>

                <h3 style="color:#00ff00;margin-top:20px;">Formations & Reracks</h3>
                <ul style="color:#ccc;padding-left:20px;line-height:1.8;">
                    <li><strong>Triangle Formation (4-3-2-1):</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>When a triangle is possible, teams must call rerack immediately after hitting a cup.</li>
                            <li>Failing to call rerack before hitting another cup results in losing the rack.</li>
                        </ul>
                    </li>
                    <li><strong>Special Formations:</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>Tits Formation: 4 back + 2 sides ‚Üí team must remove shirts.</li>
                            <li>Arrow Formation: Cup pointing at a player ‚Üí that player must shotgun.</li>
                        </ul>
                    </li>
                </ul>

                <h3 style="color:#00ff00;margin-top:20px;">Special Calls</h3>
                <ul style="color:#ccc;padding-left:20px;line-height:1.8;">
                    <li><strong>Sapuku:</strong> Can be called immediately after a cup is hit. Opposing team drinks unhit cups until next rerack.</li>
                    <li><strong>Other Calls:</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>Ginobes: Airball off back of table ‚Üí must shoot off-hand next turn.</li>
                            <li>Bows: Shooting with elbow over table ‚Üí shot invalid, no shot back.</li>
                            <li>Dance Cups: Ball hits non-game/stray cup ‚Üí everyone must dance.</li>
                        </ul>
                    </li>
                </ul>

                <h3 style="color:#00ff00;margin-top:20px;">Turn Losses</h3>
                <ul style="color:#ccc;padding-left:20px;line-height:1.8;">
                    <li>Yacking or not finishing a cup in allotted time ‚Üí lose next turn.</li>
                    <li>Player must finish the cup before shooting again.</li>
                </ul>

                <h3 style="color:#00ff00;margin-top:20px;">Naked Mile</h3>
                <ul style="color:#ccc;padding-left:20px;line-height:1.8;">
                    <li>If a player never hits a single cup during a game, they must run a naked mile.</li>
                    <li>Tri/Quad hits do NOT count as hitting a cup.</li>
                </ul>

                <h3 style="color:#00ff00;margin-top:20px;">Redemption & Overtime</h3>
                <ul style="color:#ccc;padding-left:20px;line-height:1.8;">
                    <li><strong>Redemption:</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>After last cup is hit, losing team attempts to hit remaining cups.</li>
                            <li>Shots follow the same rules as the main game.</li>
                        </ul>
                    </li>
                    <li><strong>Overtime:</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>Standard game: 30 beers (15 per side).</li>
                            <li>Overtime: 6 cups, 3 per player (4.5 beers each).</li>
                            <li>If overtime is completed and the losing team hits all cups ‚Üí Double Overtime: full 30-beer game set up again.</li>
                            <li>First team to hit game-winning cup retains balls back if applicable.</li>
                        </ul>
                    </li>
                </ul>

                <h3 style="color:#00ff00;margin-top:20px;">General Rules</h3>
                <ul style="color:#ccc;padding-left:20px;line-height:1.8;">
                    <li><strong>Gentleman's Game:</strong> Silence unless the shooter wants conversation or singing.</li>
                    <li><strong>Song Rule:</strong> Each player picks a redemption song and sticks to it forever. Shooter can shoot whenever during the song; hitting a cup restarts the song.</li>
                    <li><strong>Yacks & Turn Penalties:</strong> Missing or failing to drink ‚Üí next turn lost.</li>
                    <li><strong>Defense:</strong> Allowed only for catching/swats. No bounce shots.</li>
                    <li><strong>No elbow-over-table shooting, no shooting on song change</strong></li>
                </ul>

                <h3 style="color:#00ff00;margin-top:30px;border-top:2px solid #00ff00;padding-top:20px;">ELO Rating System</h3>
                <p style="color:#ccc;line-height:1.8;margin-bottom:15px;">Fisher Ruski uses a comprehensive ELO system that rewards individual performance, teamwork, and consistency.</p>
                
                <h4 style="color:#00ff00;margin-top:15px;font-size:1.1rem;">Base Formula</h4>
                <p style="color:#ccc;line-height:1.8;background:#0a0a0a;padding:15px;border-radius:5px;font-family:monospace;">
                    ELO Change = (Win Share √ó 100) + (Cup Points) - (Yack Penalty) + (Margin Bonus/Penalty) + (Multi-Game Bonus)
                </p>

                <h4 style="color:#00ff00;margin-top:20px;font-size:1.1rem;">Component Breakdown</h4>
                <ul style="color:#ccc;padding-left:20px;line-height:1.8;">
                    <li><strong>Win Share (Winners only - 100 points divided by team):</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>1v1: Winner gets 100 points</li>
                            <li>2v2: Each winner gets 50 points</li>
                            <li>3v3: Each winner gets 33.3 points</li>
                            <li>4v4: Each winner gets 25 points</li>
                        </ul>
                    </li>
                    <li style="margin-top:10px;"><strong>Loss Penalty (Losers only):</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>1v1: Loser gets -50 points</li>
                            <li>2v2: Each loser gets -25 points</li>
                            <li>3v3: Each loser gets -16.7 points</li>
                            <li>4v4: Each loser gets -12.5 points</li>
                        </ul>
                    </li>
                    <li style="margin-top:10px;"><strong>Cup Points (All players):</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>Regular Cup: +5 points</li>
                            <li>Redemption Cup: +15 points (3√ó multiplier)</li>
                            <li>Overtime Cup: +7.5 points (1.5√ó multiplier)</li>
                        </ul>
                    </li>
                    <li style="margin-top:10px;"><strong>Yack Penalty (All players):</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>Each Yack: -15 points</li>
                        </ul>
                    </li>
                    <li style="margin-top:10px;"><strong>Margin Bonus/Penalty:</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>Calculated as: (Your Cups - Opponent Average Cups) √ó 3</li>
                            <li>Winners: Only positive margins count</li>
                            <li>Losers: Only negative margins count (penalty)</li>
                            <li>Example (Winner): You hit 10, opponents averaged 5 ‚Üí +15 points</li>
                            <li>Example (Loser): You hit 3, opponents averaged 8 ‚Üí -15 points</li>
                        </ul>
                    </li>
                    <li style="margin-top:10px;"><strong>Multi-Game Bonus (All players):</strong>
                        <ul style="padding-left:20px;margin-top:5px;">
                            <li>First game of the day: Standard calculation</li>
                            <li>Second game of the day: +20% to total ELO change</li>
                            <li>Third+ game of the day: +30% to total ELO change</li>
                            <li>Encourages tournament play and consistency</li>
                        </ul>
                    </li>
                </ul>

                <h4 style="color:#00ff00;margin-top:20px;font-size:1.1rem;">Example Calculations</h4>
                <div style="background:#0a0a0a;padding:15px;border-radius:5px;color:#ccc;line-height:1.8;margin-top:10px;">
                    <strong style="color:#00ff00;">Winner Scenario:</strong> 2v2 game, you won, hit 8 cups, 1 redemption cup, 1 yack, opponents averaged 4 cups, this is your 2nd game today
                    <br><br>
                    <strong style="color:#00ff00;">Calculation:</strong>
                    <ul style="padding-left:20px;margin-top:5px;">
                        <li>Win Share: 100 √∑ 2 = 50 points</li>
                        <li>Cup Points: (8 √ó 5) + (1 √ó 15) = 55 points</li>
                        <li>Yack Penalty: 1 √ó -15 = -15 points</li>
                        <li>Margin Bonus: (8 - 4) √ó 3 = 12 points</li>
                        <li>Subtotal: 102 points</li>
                        <li>Multi-Game Bonus: 102 √ó 1.20 = 122.4 points</li>
                    </ul>
                    <strong style="color:#00ff00;">Final ELO Change: +122 points</strong>
                </div>

                <div style="background:#0a0a0a;padding:15px;border-radius:5px;color:#ccc;line-height:1.8;margin-top:10px;">
                    <strong style="color:#ff6666;">Loser Scenario:</strong> 2v2 game, you lost, hit 3 cups, 2 yacks, opponents averaged 9 cups, this is your 1st game today
                    <br><br>
                    <strong style="color:#00ff00;">Calculation:</strong>
                    <ul style="padding-left:20px;margin-top:5px;">
                        <li>Loss Penalty: -50 √∑ 2 = -25 points</li>
                        <li>Cup Points: 3 √ó 5 = 15 points</li>
                        <li>Yack Penalty: 2 √ó -15 = -30 points</li>
                        <li>Margin Penalty: (3 - 9) √ó 3 = -18 points</li>
                        <li>Subtotal: -58 points</li>
                        <li>Multi-Game Bonus: N/A (first game)</li>
                    </ul>
                    <strong style="color:#ff6666;">Final ELO Change: -58 points</strong>
                </div>

                <h4 style="color:#00ff00;margin-top:20px;font-size:1.1rem;">Starting ELO</h4>
                <p style="color:#ccc;line-height:1.8;">All players begin at 1000 ELO. Rankings are relative and evolve based on performance over time.</p>
            </div>
        </div>

        <div id="admin" class="page">
            <div id="admin-login" class="card">
                <h2>Admin Login</h2>
                <div class="form-group">
                    <input type="password" id="admin-password" placeholder="Password">
                </div>
                <button class="btn" onclick="adminLogin()">Login</button>
                <p id="login-error" style="color:#ff0000;display:none;">Incorrect!</p>
            </div>
            <div id="admin-panel" style="display:none;">
                <div class="card">
                    <h2>All Games</h2>
                    <button class="btn" onclick="adminLogout()" style="background:#ff0000;float:right;">Logout</button>
                    <div style="clear:both;"></div>
                    <div id="approved-games-container"></div>
                    <div id="no-approved-games" style="text-align:center;color:#888;padding:40px;">No games yet</div>
                </div>
                <div class="card">
                    <h2>Player Roster</h2>
                    <div class="form-group">
                        <label>Add New Player</label>
                        <div style="display:flex;gap:10px;">
                            <input type="text" id="new-player-name" placeholder="Enter player name">
                            <button class="btn" onclick="addNewPlayer()">Add Player</button>
                        </div>
                    </div>
                    <div id="player-roster-list"></div>
                </div>
                <div class="card">
                    <h2>Data Management</h2>
                    <div style="display:flex;gap:10px;margin-bottom:15px;">
                        <button class="btn" onclick="exportData()">Export JSON Backup</button>
                        <label class="btn" style="background:#666;display:inline-block;cursor:pointer;">
                            Import JSON Backup
                            <input type="file" accept=".json" onchange="importData(event)" style="display:none;">
                        </label>
                    </div>
                    <p style="color:#888;font-size:0.9rem;margin-top:10px;">Export downloads a JSON backup file. Import to restore from a saved backup file.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-btn active" onclick="showPage('home')">
            <div class="nav-icon">üè†</div>
            <div>Home</div>
        </button>
        <button class="nav-btn" onclick="showPage('submit')">
            <div class="nav-icon">‚ûï</div>
            <div>Submit</div>
        </button>
        <button class="nav-btn" onclick="showPage('rankings')">
            <div class="nav-icon">üèÜ</div>
            <div>Rankings</div>
        </button>
        <button class="nav-btn" onclick="showPage('players')">
            <div class="nav-icon">üë§</div>
            <div>Players</div>
        </button>
        <button class="nav-btn" onclick="showPage('rules')">
            <div class="nav-icon">üìã</div>
            <div>Rules</div>
        </button>
        <button class="nav-btn" onclick="showPage('admin')">
            <div class="nav-icon">‚öôÔ∏è</div>
            <div>Admin</div>
        </button>
    </div>

    <script>
        let approvedGames = [];
        let playerRoster = [];
        let gameIdCounter = 1;

        // Firebase Configuration - PASTE YOUR CONFIG HERE
        const firebaseConfig = {
  apiKey: "AIzaSyC-NDVNlEJuForEGwmjbsezHiYMOXh_HUk",
  authDomain: "fisher-ruski-tracker.firebaseapp.com",
  databaseURL: "https://fisher-ruski-tracker-default-rtdb.firebaseio.com",
  projectId: "fisher-ruski-tracker",
  storageBucket: "fisher-ruski-tracker.firebasestorage.app",
  messagingSenderId: "957714588163",
  appId: "1:957714588163:web:3df268d93fbdc4ea932436"
};

        
        // Initialize Firebase
        // Initialize Firebase - wait for scripts to load
let database;
        
emailjs.init(pyEFhKTszWQu0O5ZC); 
        
window.addEventListener('load', function() {
    firebase.initializeApp(firebaseConfig);
    database = firebase.database();
    loadFromFirebase();
});

        // Load data from Firebase
        function loadFromFirebase() {
            database.ref('fisherRuskiData').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    approvedGames = data.approvedGames || [];
                    playerRoster = data.playerRoster || [];
                    gameIdCounter = data.gameIdCounter || 1;
                    
                    // Update all displays
                    updateAllGamesList();
                    updateHomeStats();
                    updateHighlights('week');
                    updatePlayersList();
                    updateRankings();
                    
                    console.log('Data loaded from Firebase');
                }
            });
        }

        // Save data to Firebase
        function saveToFirebase() {
            const data = {
                approvedGames: approvedGames,
                playerRoster: playerRoster,
                gameIdCounter: gameIdCounter,
                lastSaved: new Date().toISOString()
            };
            
            database.ref('fisherRuskiData').set(data)
                .then(() => {
                    console.log('Data saved to Firebase');
                })
                .catch((error) => {
                    console.error('Error saving data:', error);
                    alert('Error saving data. Check your internet connection.');
                });
        }


        // Auto-log test game
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            const navBtns = document.querySelectorAll('.nav-btn');
            navBtns.forEach(btn => {
                if (btn.getAttribute('onclick').includes(`'${pageId}'`)) {
                    btn.classList.add('active');
                }
            });
            
            if (pageId === 'admin') updateApprovedGamesDisplay();
            if (pageId === 'home') {
                updateAllGamesList();
                updateHomeStats();
                updateHighlights('week');
            }
            if (pageId === 'players') updatePlayersList();
            if (pageId === 'rankings') updateRankings();
        }

        function generateTeams() {
            const size = parseInt(document.getElementById('team-size').value);
            const container = document.getElementById('teams-container');
            const btn = document.getElementById('next-btn');
            
            if (!size) {
                container.innerHTML = '';
                btn.style.display = 'none';
                return;
            }

            let html = '<div class="teams-grid">';
            for (let team = 1; team <= 2; team++) {
                html += `<div class="team"><h3>Team ${team}</h3>`;
                for (let i = 0; i < size; i++) {
                    html += `<div class="form-group"><select id="t${team}p${i}" onchange="checkOther(this,'t${team}p${i}o')">
                        <option value="">Select</option>
                        ${playerRoster.map(p => `<option value="${p}">${p}</option>`).join('')}
                        <option value="__OTHER__">+ New Player</option>
                    </select>
                    <input type="text" id="t${team}p${i}o" placeholder="Name" style="display:none;margin-top:5px;width:100%;padding:10px;background:#222;border:1px solid #00ff00;color:#00ff00;border-radius:5px;"></div>`;
                }
                html += '</div>';
            }
            html += '</div>';
            container.innerHTML = html;
            btn.style.display = 'block';
        }

        function checkOther(sel, id) {
            const inp = document.getElementById(id);
            inp.style.display = sel.value === '__OTHER__' ? 'block' : 'none';
        }

        function getName(team, i) {
            const sel = document.getElementById(`t${team}p${i}`);
            return sel.value === '__OTHER__' ? document.getElementById(`t${team}p${i}o`).value.trim() : sel.value;
        }

        function goToStep2() {
    const size = parseInt(document.getElementById('team-size').value);
    if (!size || !document.getElementById('winning-team').value) {
        alert('Select team size and winner!');
        return;
    }

    for (let t = 1; t <= 2; t++) {
        for (let i = 0; i < size; i++) {
            if (!getName(t, i)) {
                alert(`Enter player for Team ${t} Player ${i+1}`);
                return;
            }
        }
    }

    const hadOvertime = document.getElementById('had-overtime').value === 'yes';

    const container = document.getElementById('individual-stats');
    let html = '';
    
    // If overtime, ask who hit the redemption cup first
    if (hadOvertime) {
        html += `<div style="background:#1a1a00;border:2px solid #ffff00;padding:20px;border-radius:8px;margin-bottom:20px;">
            <h3 style="color:#ffff00;margin-bottom:15px;">Who hit the Redemption Cup?</h3>
            <div class="form-group">
                <select id="redemption-shooter">
                    <option value="">Select Player</option>`;
        
        for (let t = 1; t <= 2; t++) {
            for (let i = 0; i < size; i++) {
                const name = getName(t, i);
                html += `<option value="${name}">${name}</option>`;
            }
        }
        
         html += '</div>';
    container.innerHTML = html;
    }
    
    for (let t = 1; t <= 2; t++) {
        for (let i = 0; i < size; i++) {
            const name = getName(t, i);
            html += `<div class="player-stats"><h4>${name}</h4><div class="stats-grid-form">
                <div class="form-group"><label>Regular Cups</label><input type="number" id="t${t}p${i}c" min="0" value="0"></div>`;
            
            if (hadOvertime) {
                html += `<div class="form-group"><label>Overtime Cups</label><input type="number" id="t${t}p${i}o" min="0" value="0"></div>`;
            }
            
            html += `<div class="form-group"><label>Yacks</label><input type="number" id="t${t}p${i}y" min="0" value="0"></div>
            </div></div>`;
        }
    }
    container.innerHTML = html;
    document.getElementById('step1').style.display = 'none';
    document.getElementById('step2').style.display = 'block';
}

        function goToStep1() {
            document.getElementById('step1').style.display = 'block';
            document.getElementById('step2').style.display = 'none';
        }

        function submitGame() {
    const size = parseInt(document.getElementById('team-size').value);
    const winner = parseInt(document.getElementById('winning-team').value);
    const hadOvertime = document.getElementById('had-overtime').value === 'yes';
    
    let redemptionShooter = '';
    if (hadOvertime) {
        redemptionShooter = document.getElementById('redemption-shooter').value;
        if (!redemptionShooter) {
            alert('Please select who hit the redemption cup!');
            return;
        }
    }
    
    const game = {
        id: gameIdCounter++,
        date: new Date().toLocaleString(),
        size: size,
        winningTeam: winner,
        teams: []
    };
    
    for (let t = 1; t <= 2; t++) {
        const team = [];
        for (let i = 0; i < size; i++) {
            const name = getName(t, i);
            if (!playerRoster.includes(name)) {
                playerRoster.push(name);
                playerRoster.sort();
            }
            
            const cups = parseInt(document.getElementById(`t${t}p${i}c`).value) || 0;
            const overtimeCupsEl = document.getElementById(`t${t}p${i}o`);
            const overtimeCups = (hadOvertime && overtimeCupsEl) ? (parseInt(overtimeCupsEl.value) || 0) : 0;
            const yacks = parseInt(document.getElementById(`t${t}p${i}y`).value) || 0;
            
            // If this player hit the redemption cup, give them 1 redemption cup
            const redemptionCups = (hadOvertime && name === redemptionShooter) ? 1 : 0;
            
            team.push({
                name: name,
                cups: cups,
                redemptionCups: redemptionCups,
                overtimeCups: overtimeCups,
                yacks: yacks,
                nakedMile: cups === 0 && redemptionCups === 0 && overtimeCups === 0
            });
        }
        game.teams.push(team);
    }
    
    approvedGames.push(game);
    alert('Game submitted!');
    
    document.getElementById('team-size').value = '';
    document.getElementById('winning-team').value = '';
    document.getElementById('had-overtime').value = 'no';
    document.getElementById('teams-container').innerHTML = '';
    document.getElementById('next-btn').style.display = 'none';
    goToStep1();
    showPage('home');
    saveToFirebase();

        console.log('About to send email...');
    const t1 = game.teams[0].map(p => p.name).join(' & ');
    const t2 = game.teams[1].map(p => p.name).join(' & ');
    const winnerTeam = winner === 1 ? t1 : t2;

    emailjs.send(service_r168u8q, template_lawx1fc, {
    to_email: abelrupertus06@gmail.com,
    game_info: `${t1} vs ${t2}`,
    winner: `Team ${winner} (${winnerTeam})`,
    date: game.date
    }).then(
    function(response) {
        console.log('Email sent!', response);
    },
    function(error) {
        console.log('Email failed:', error);
    }
    );       
}

        function adminLogin() {
            if (document.getElementById('admin-password').value === 'bbsucks') {
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                updateApprovedGamesDisplay();
                updatePlayerRoster();
            } else {
                document.getElementById('login-error').style.display = 'block';
            }
        }

        function adminLogout() {
            document.getElementById('admin-login').style.display = 'block';
            document.getElementById('admin-panel').style.display = 'none';
        }

        function updateApprovedGamesDisplay() {
            const c = document.getElementById('approved-games-container');
            const n = document.getElementById('no-approved-games');
            
            if (approvedGames.length === 0) {
                c.innerHTML = '';
                n.style.display = 'block';
                return;
            }
            
            n.style.display = 'none';
            let html = '<table class="table"><thead><tr><th>ID</th><th>Date</th><th>Match</th><th>Winner</th><th>Actions</th></tr></thead><tbody>';
            approvedGames.forEach((g, i) => {
                const t1 = g.teams[0].map(p => p.name).join(' & ');
                const t2 = g.teams[1].map(p => p.name).join(' & ');
                const winner = g.winningTeam === 1 ? 'Team 1' : 'Team 2';
                html += `<tr>
                    <td>${g.id}</td>
                    <td>${g.date}</td>
                    <td>${t1} vs ${t2}</td>
                    <td>${winner}</td>
                    <td>
                        <button class="btn" style="padding:5px 10px;font-size:12px;margin-right:5px;" onclick="editGame(${i})">Edit</button>
                        <button class="btn" style="padding:5px 10px;font-size:12px;background:#ff0000;" onclick="deleteGame(${i})">Delete</button>
                    </td>
                </tr>`;
            });
            html += '</tbody></table>';
            c.innerHTML = html;
        }

        function editGame(index) {
            const game = approvedGames[index];
            const t1 = game.teams[0].map(p => p.name).join(' & ');
            const t2 = game.teams[1].map(p => p.name).join(' & ');
            
            let html = `
                <div class="card" style="background:#1a1a00;border:2px solid #ffff00;">
                    <h2 style="color:#ffff00;">Edit Game #${game.id}</h2>
                    <div class="form-group">
                        <label>Winner</label>
                        <select id="edit-winner">
                            <option value="1" ${game.winningTeam === 1 ? 'selected' : ''}>Team 1 (${t1})</option>
                            <option value="2" ${game.winningTeam === 2 ? 'selected' : ''}>Team 2 (${t2})</option>
                        </select>
                    </div>
                    <h3 style="color:#ffff00;margin-top:20px;">Team 1 Players</h3>`;
            
            game.teams[0].forEach((p, i) => {
                html += `
                    <div style="background:#0a0a0a;padding:15px;margin:10px 0;border-radius:5px;">
                        <div class="form-group">
                            <label>Player Name</label>
                            <select id="edit-t1p${i}">
                                ${playerRoster.map(name => `<option value="${name}" ${name === p.name ? 'selected' : ''}>${name}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Regular Cups</label>
                            <input type="number" id="edit-t1c${i}" value="${p.cups}" min="0">
                        </div>
                        <div class="form-group">
                            <label>Redemption Cups</label>
                            <input type="number" id="edit-t1r${i}" value="${p.redemptionCups || 0}" min="0">
                        </div>
                        <div class="form-group">
                            <label>Overtime Cups</label>
                            <input type="number" id="edit-t1o${i}" value="${p.overtimeCups || 0}" min="0">
                        </div>
                        <div class="form-group">
                            <label>Yacks</label>
                            <input type="number" id="edit-t1y${i}" value="${p.yacks}" min="0">
                        </div>
                    </div>`;
            });
            
            html += `<h3 style="color:#ffff00;margin-top:20px;">Team 2 Players</h3>`;
            
            game.teams[1].forEach((p, i) => {
                html += `
                    <div style="background:#0a0a0a;padding:15px;margin:10px 0;border-radius:5px;">
                        <div class="form-group">
                            <label>Player Name</label>
                            <select id="edit-t2p${i}">
                                ${playerRoster.map(name => `<option value="${name}" ${name === p.name ? 'selected' : ''}>${name}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Regular Cups</label>
                            <input type="number" id="edit-t2c${i}" value="${p.cups}" min="0">
                        </div>
                        <div class="form-group">
                            <label>Redemption Cups</label>
                            <input type="number" id="edit-t2r${i}" value="${p.redemptionCups || 0}" min="0">
                        </div>
                        <div class="form-group">
                            <label>Overtime Cups</label>
                            <input type="number" id="edit-t2o${i}" value="${p.overtimeCups || 0}" min="0">
                        </div>
                        <div class="form-group">
                            <label>Yacks</label>
                            <input type="number" id="edit-t2y${i}" value="${p.yacks}" min="0">
                        </div>
                    </div>`;
            });
            
            html += `
                    <button class="btn" onclick="saveGameEdit(${index})" style="background:#00ff00;">Save Changes</button>
                    <button class="btn" onclick="cancelEdit()" style="background:#666;margin-left:10px;">Cancel</button>
                </div>`;
            
            document.getElementById('approved-games-container').innerHTML = html;
            document.getElementById('no-approved-games').style.display = 'none';
        }

        function saveGameEdit(index) {
            const game = approvedGames[index];
            game.winningTeam = parseInt(document.getElementById('edit-winner').value);
            
            for (let t = 0; t < 2; t++) {
                game.teams[t].forEach((p, i) => {
                    const teamNum = t + 1;
                    p.name = document.getElementById(`edit-t${teamNum}p${i}`).value;
                    p.cups = parseInt(document.getElementById(`edit-t${teamNum}c${i}`).value) || 0;
                    p.redemptionCups = parseInt(document.getElementById(`edit-t${teamNum}r${i}`).value) || 0;
                    p.overtimeCups = parseInt(document.getElementById(`edit-t${teamNum}o${i}`).value) || 0;
                    p.yacks = parseInt(document.getElementById(`edit-t${teamNum}y${i}`).value) || 0;
                });
            }
            
            alert('Game updated!');
            updateApprovedGamesDisplay();
            updateAllGamesList();
            saveToFirebase();
        }

        function cancelEdit() {
            updateApprovedGamesDisplay();
        }

        function updatePlayerRoster() {
            const c = document.getElementById('player-roster-list');
            if (playerRoster.length === 0) {
                c.innerHTML = '<p style="color:#888;">No players yet</p>';
                return;
            }
            let html = '<div style="margin-top:15px;"><strong style="color:#00ff00;">Total Players: ' + playerRoster.length + '</strong></div><ul style="margin-top:10px;">';
            playerRoster.forEach((p, i) => html += `<li style="color:#00ff00;margin:5px 0;display:flex;justify-content:space-between;align-items:center;">
                <span>${p}</span>
                <button class="btn" style="padding:3px 8px;font-size:11px;background:#ff0000;" onclick="removePlayer(${i})">Remove</button>
            </li>`);
            html += '</ul>';
            c.innerHTML = html;
        }

        function addNewPlayer() {
            const name = document.getElementById('new-player-name').value.trim();
            if (!name) {
                alert('Enter a player name');
                return;
            }
            if (playerRoster.includes(name)) {
                alert('Player already exists');
                return;
            }
            playerRoster.push(name);
            playerRoster.sort();
            document.getElementById('new-player-name').value = '';
            updatePlayerRoster();
            alert('Player added to roster!');
            saveToFirebase(); 
        }

        function removePlayer(index) {
            if (confirm('Remove ' + playerRoster[index] + ' from roster? This will not affect existing games.')) {
                playerRoster.splice(index, 1);
                updatePlayerRoster();
                saveToFirebase();
        
            }
        }

        function deleteGame(i) {
            if (confirm('Delete game?')) {
                approvedGames.splice(i, 1);
                updateApprovedGamesDisplay();
                updateAllGamesList();
                saveToFirebase();

            }
        }

        function updateAllGamesList() {
            const c = document.getElementById('all-games-list');
            const n = document.getElementById('no-games-yet');
            
            if (approvedGames.length === 0) {
                c.innerHTML = '';
                n.style.display = 'block';
                return;
            }
            
            n.style.display = 'none';
            let html = '<table class="table"><thead><tr><th>Date</th><th>Match</th><th>Winner</th></tr></thead><tbody>';
            [...approvedGames].reverse().forEach(g => {
                const t1 = g.teams[0].map(p => p.name).join(' & ');
                const t2 = g.teams[1].map(p => p.name).join(' & ');
                const w = g.winningTeam === 1 ? t1 : t2;
                html += `<tr><td>${g.date}</td><td>${t1} vs ${t2}</td><td style="color:#ffff00;">${w}</td></tr>`;
            });
            html += '</tbody></table>';
            c.innerHTML = html;
        }

        document.getElementById('team-size').addEventListener('change', generateTeams);

        function updatePlayersList() {
            const list = document.getElementById('players-list');
            const noPlayers = document.getElementById('no-players');
            
            if (playerRoster.length === 0) {
                list.innerHTML = '';
                noPlayers.style.display = 'block';
                return;
            }
            
            noPlayers.style.display = 'none';
            let html = '<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:15px;">';
            
            playerRoster.forEach(player => {
                const stats = getPlayerStats(player);
                html += `
                    <div class="stat-box" style="cursor:pointer;transition:all 0.3s;" onclick="showPlayerProfile('${player}')">
                        <div style="font-size:1.5rem;margin-bottom:10px;">üë§</div>
                        <div class="stat-number" style="font-size:1.3rem;">${player}</div>
                        <div class="stat-label" style="margin-top:10px;">
                            ${stats.games} Games | ${stats.wins}W-${stats.losses}L
                        </div>
                        <div style="color:#888;font-size:0.85rem;margin-top:5px;">
                            ${stats.totalCups} Cups | ${stats.winRate}% Win Rate
                        </div>
                    </div>`;
            });
            
            html += '</div>';
            list.innerHTML = html;
        }

        function calculateELO(playerName) {
            let elo = 1000;
            const gamesPerDay = {};
            
            approvedGames.forEach(game => {
                let playerTeam = null;
                let playerData = null;
                
                game.teams.forEach((team, teamIndex) => {
                    team.forEach(player => {
                        if (player.name === playerName) {
                            playerTeam = teamIndex + 1;
                            playerData = player;
                        }
                    });
                });
                
                if (playerTeam) {
                    const gameDate = game.date.split(',')[0];
                    gamesPerDay[gameDate] = (gamesPerDay[gameDate] || 0) + 1;
                    const gameNumber = gamesPerDay[gameDate];
                    
                    const isWinner = playerTeam === game.winningTeam;
                    const teamSize = game.size;
                    
                    const regularCupPoints = playerData.cups * 5;
                    const redemptionCupPoints = (playerData.redemptionCups || 0) * 15;
                    const overtimeCupPoints = (playerData.overtimeCups || 0) * 7.5;
                    const totalCupPoints = regularCupPoints + redemptionCupPoints + overtimeCupPoints;
                    
                    const yackPenalty = playerData.yacks * -15;
                    
                    let eloChange = 0;
                    
                    if (isWinner) {
                        const winShare = 100 / teamSize;
                        
                        const losingTeam = game.teams[playerTeam === 1 ? 1 : 0];
                        const opponentAvgCups = losingTeam.reduce((sum, p) => sum + p.cups, 0) / losingTeam.length;
                        const marginBonus = Math.max(0, (playerData.cups - opponentAvgCups) * 3);
                        
                        eloChange = winShare + totalCupPoints + marginBonus + yackPenalty;
                    } else {
                        const winningTeam = game.teams[playerTeam === 1 ? 1 : 0];
                        const opponentAvgCups = winningTeam.reduce((sum, p) => sum + p.cups, 0) / winningTeam.length;
                        
                        const lossPenalty = -50 / teamSize;
                        const marginPenalty = Math.min(0, (playerData.cups - opponentAvgCups) * 3);
                        
                        eloChange = lossPenalty + totalCupPoints + marginPenalty + yackPenalty;
                    }
                    
                    if (gameNumber === 2) {
                        eloChange *= 1.20;
                    } else if (gameNumber >= 3) {
                        eloChange *= 1.30;
                    }
                    
                    elo += eloChange;
                }
            });
            
            return Math.round(elo);
        }

        function getPlayerStats(playerName) {
            let games = 0;
            let wins = 0;
            let losses = 0;
            let totalCups = 0;
            let totalYacks = 0;
            let nakedMiles = 0;
            
            approvedGames.forEach(game => {
                let playerTeam = null;
                let playerData = null;
                
                game.teams.forEach((team, teamIndex) => {
                    team.forEach(player => {
                        if (player.name === playerName) {
                            playerTeam = teamIndex + 1;
                            playerData = player;
                        }
                    });
                });
                
                if (playerTeam) {
                    games++;
                    totalCups += playerData.cups;
                    totalYacks += playerData.yacks;
                    if (playerData.nakedMile) nakedMiles++;
                    
                    if (playerTeam === game.winningTeam) {
                        wins++;
                    } else {
                        losses++;
                    }
                }
            });
            
            const winRate = games > 0 ? Math.round((wins / games) * 100) : 0;
            
            return {
                games,
                wins,
                losses,
                totalCups,
                totalYacks,
                nakedMiles,
                winRate,
                avgCupsPerGame: games > 0 ? (totalCups / games).toFixed(1) : 0
            };
        }

        function setPeriod(period) {
            ['week', 'month', 'year', 'alltime'].forEach(p => {
                const btn = document.getElementById(`btn-${p}`);
                btn.style.background = p === period ? '#00ff00' : '#666';
            });
            
            updateHighlights(period);
        }

        function updateHighlights(period) {
            const now = new Date();
            let cutoffDate = new Date(0);
            
            if (period === 'week') {
                cutoffDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            } else if (period === 'month') {
                cutoffDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
            } else if (period === 'year') {
                cutoffDate = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
            }
            
            const filteredGames = approvedGames.filter(game => {
                const gameDate = new Date(game.date);
                return gameDate >= cutoffDate;
            });
            
            if (filteredGames.length === 0) {
                document.getElementById('top-player').textContent = 'No data';
                document.getElementById('top-player-stat').textContent = '-';
                document.getElementById('worst-player').textContent = 'No data';
                document.getElementById('worst-player-stat').textContent = '-';
                document.getElementById('best-game').textContent = 'No data';
                document.getElementById('best-game-stat').textContent = '-';
                return;
            }
            
            const playerStats = {};
            filteredGames.forEach(game => {
                game.teams.forEach((team, teamIndex) => {
                    team.forEach(player => {
                        if (!playerStats[player.name]) {
                            playerStats[player.name] = { wins: 0, losses: 0, cups: 0, games: 0 };
                        }
                        playerStats[player.name].games++;
                        playerStats[player.name].cups += player.cups;
                        if (teamIndex + 1 === game.winningTeam) {
                            playerStats[player.name].wins++;
                        } else {
                            playerStats[player.name].losses++;
                        }
                    });
                });
            });
            
            let topPlayer = null;
            let topWinRate = -1;
            Object.entries(playerStats).forEach(([name, stats]) => {
                const winRate = stats.wins / stats.games;
                if (winRate > topWinRate) {
                    topWinRate = winRate;
                    topPlayer = { name, ...stats };
                }
            });
            
            if (topPlayer) {
                document.getElementById('top-player').textContent = topPlayer.name;
                document.getElementById('top-player-stat').textContent = `${topPlayer.wins}W-${topPlayer.losses}L (${Math.round(topWinRate * 100)}%)`;
            }
            
            let worstPlayer= null;
            let worstWinRate = 2;
            Object.entries(playerStats).forEach(([name, stats]) => {
                const winRate = stats.wins / stats.games;
                if (winRate < worstWinRate) {
                    worstWinRate = winRate;
                    worstPlayer = { name, ...stats };
                }
            });
            
            if (worstPlayer) {
                document.getElementById('worst-player').textContent = worstPlayer.name;
                document.getElementById('worst-player-stat').textContent = `${worstPlayer.wins}W-${worstPlayer.losses}L (${Math.round(worstWinRate * 100)}%)`;
            }
            
            let bestGame = null;
            let mostCups = 0;
            filteredGames.forEach(game => {
                let totalCups = 0;
                game.teams.forEach(team => {
                    team.forEach(player => totalCups += player.cups);
                });
                if (totalCups > mostCups) {
                    mostCups = totalCups;
                    bestGame = game;
                }
            });
            
            if (bestGame) {
                const t1 = bestGame.teams[0].map(p => p.name).join(' & ');
                const t2 = bestGame.teams[1].map(p => p.name).join(' & ');
                document.getElementById('best-game').textContent = `${t1} vs ${t2}`;
                document.getElementById('best-game-stat').textContent = `${mostCups} total cups`;
            }
        }

        function updateHomeStats() {
            document.getElementById('total-players').textContent = playerRoster.length;
            document.getElementById('total-games').textContent = approvedGames.length;
            
            let highestElo = 0;
            if (playerRoster.length > 0) {
                playerRoster.forEach(player => {
                    const elo = calculateELO(player);
                    if (elo > highestElo) highestElo = elo;
                });
            }
            document.getElementById('highest-elo').textContent = highestElo;
        }

        function showPlayerProfile(playerName) {
            const stats = getPlayerStats(playerName);
            const card = document.getElementById('player-profile-card');
            const content = document.getElementById('player-profile-content');
            
            let html = `
                <h2 style="color:#00ff00;margin-top:20px;margin-bottom:30px;text-align:center;font-size:2rem;">
                    üë§ ${playerName}
                </h2>
                
                <div class="stats-grid" style="margin-bottom:30px;">
                    <div class="stat-box">
                        <span class="stat-number">${stats.games}</span>
                        <div class="stat-label">Games Played</div>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number">${stats.wins}-${stats.losses}</span>
                        <div class="stat-label">Win-Loss</div>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number">${stats.winRate}%</span>
                        <div class="stat-label">Win Rate</div>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number">${stats.totalCups}</span>
                        <div class="stat-label">Total Cups</div>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number">${stats.avgCupsPerGame}</span>
                        <div class="stat-label">Avg Cups/Game</div>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number">${stats.totalYacks}</span>
                        <div class="stat-label">Total Yacks</div>
                    </div>
                    <div class="stat-box" style="${stats.nakedMiles > 0 ? 'background:#2a0000;border-color:#ff0000;' : ''}">
                        <span class="stat-number" style="${stats.nakedMiles > 0 ? 'color:#ff6666;' : ''}">${stats.nakedMiles}</span>
                        <div class="stat-label">Naked Miles</div>
                    </div>
                </div>
                
                <h3 style="color:#00ff00;margin-bottom:15px;">Game History</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Match</th>
                            <th>Result</th>
                            <th>Cups</th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            [...approvedGames].reverse().forEach(game => {
                let playerTeam = null;
                let playerData = null;
                
                game.teams.forEach((team, teamIndex) => {
                    team.forEach(player => {
                        if (player.name === playerName) {
                            playerTeam = teamIndex + 1;
                            playerData = player;
                        }
                    });
                });
                
                if (playerTeam) {
                    const t1 = game.teams[0].map(p => p.name).join(' & ');
                    const t2 = game.teams[1].map(p => p.name).join(' & ');
                    const won = playerTeam === game.winningTeam;
                    const result = won ? 'WIN' : 'LOSS';
                    const resultColor = won ? '#00ff00' : '#ff6666';
                    
                    html += `
                        <tr>
                            <td>${game.date}</td>
                            <td>${t1} vs ${t2}</td>
                            <td style="color:${resultColor};font-weight:bold;">${result}</td>
                            <td>${playerData.cups}</td>
                        </tr>`;
                }
            });
            
            if (stats.games === 0) {
                html += '<tr><td colspan="4" style="text-align:center;color:#888;padding:40px;">No games yet</td></tr>';
            }
            
            html += '</tbody></table>';
            
            content.innerHTML = html;
            card.style.display = 'block';
            document.getElementById('players-list').style.display = 'none';
            document.getElementById('no-players').style.display = 'none';
        }

        function closePlayerProfile() {
            document.getElementById('player-profile-card').style.display = 'none';
            document.getElementById('players-list').style.display = 'block';
            updatePlayersList();
        }

        function updateRankings() {
            const tbody = document.getElementById('rankings-tbody');
            
            if (playerRoster.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#888;padding:40px;">No games yet</td></tr>';
                return;
            }
            
            const rankings = playerRoster.map(player => {
                const stats = getPlayerStats(player);
                return {
                    name: player,
                    ...stats,
                    elo: calculateELO(player)
                };
            }).sort((a, b) => b.elo - a.elo);
            
            let html = '';
            rankings.forEach((player, index) => {
                html += `
                    <tr style="cursor:pointer;" onclick="showPlayerProfile('${player.name}'); showPage('players');">
                        <td>${index + 1}</td>
                        <td style="color:#00ff00;font-weight:bold;">${player.name}</td>
                        <td>${player.elo}</td>
                        <td>${player.games}</td>
                        <td>${player.winRate}%</td>
                    </tr>`;
            });
            
            tbody.innerHTML = html;
        }

        function exportData() {
            const data = {
                approvedGames: approvedGames,
                playerRoster: playerRoster,
                gameIdCounter: gameIdCounter,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `fisher-ruski-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            alert('Data exported successfully!');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('This will replace all current data. Continue?')) {
                        approvedGames = data.approvedGames || [];
                        playerRoster = data.playerRoster || [];
                        gameIdCounter = data.gameIdCounter || 1;
                        
                        alert('Data imported successfully!');
                        updateApprovedGamesDisplay();
                        updatePlayerRoster();
                        updateAllGamesList();
                        updateHomeStats();
                        updateHighlights('week');
                    }
                } catch (error) {
                    alert('Error importing data: Invalid file format');
                }
            };
            reader.readAsText(file);
            
            event.target.value = '';
        }

        // Initialize on load
        updateHomeStats();
        updateHighlights('week');
    </script>
</body>
</html>
